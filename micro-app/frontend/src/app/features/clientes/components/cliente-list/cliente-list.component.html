<div class="cliente-list-container">
  <div class="header">
    <h1>Clientes</h1>
    <a mat-fab color="primary" routerLink="/clientes/nuevo" class="add-btn">
      <mat-icon>add</mat-icon>
    </a>
  </div>

  <!-- Filtros de búsqueda -->
  <mat-card class="search-card">
    <div class="filters-row">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Nombre</mat-label>
        <input
          matInput
          [(ngModel)]="filtroNombre"
          placeholder="Buscar por nombre o apellido"
          (keyup.enter)="buscarClientes()"
        />
        <mat-icon matSuffix>person</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>DUI</mat-label>
        <input
          matInput
          [(ngModel)]="filtroDui"
          placeholder="Buscar por DUI"
          (keyup.enter)="buscarClientes()"
        />
        <mat-icon matSuffix>badge</mat-icon>
      </mat-form-field>

      <div class="filter-actions">
        <button
          mat-raised-button
          color="primary"
          (click)="buscarClientes()"
          [disabled]="isLoading()"
        >
          <mat-icon>search</mat-icon>
          Buscar
        </button>
        <button
          mat-stroked-button
          (click)="limpiarFiltros()"
          [disabled]="isLoading()"
        >
          <mat-icon>clear</mat-icon>
          Limpiar
        </button>
      </div>
    </div>
  </mat-card>

  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else if (!buscado()) {
    <!-- Estado inicial: mostrar mensaje para buscar -->
    <mat-card class="empty-card">
      <mat-card-content>
        <mat-icon>search</mat-icon>
        <p>Ingrese criterios de búsqueda para encontrar clientes</p>
        <p class="hint">Puede buscar por nombre, apellido o DUI</p>
      </mat-card-content>
    </mat-card>
  } @else {
    <!-- Vista móvil: Cards -->
    <div class="mobile-view">
      @for (cliente of clientes(); track cliente.id) {
        <mat-card class="cliente-card" (click)="verDetalle(cliente.id!)">
          <mat-card-header>
            <mat-card-title>{{ cliente.nombre }} {{ cliente.apellido }}</mat-card-title>
            <mat-card-subtitle>DUI: {{ cliente.numeroDui }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            @if (cliente.telefono) {
              <p><mat-icon class="inline-icon">phone</mat-icon> {{ cliente.telefono }}</p>
            }
            @if (cliente.correoElectronico) {
              <p><mat-icon class="inline-icon">email</mat-icon> {{ cliente.correoElectronico }}</p>
            }
          </mat-card-content>
          <mat-card-actions align="end">
            <button mat-icon-button color="primary" (click)="editar(cliente.id!); $event.stopPropagation()">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="eliminar(cliente.id!); $event.stopPropagation()">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-card-actions>
        </mat-card>
      } @empty {
        <mat-card class="empty-card">
          <mat-card-content>
            <mat-icon>person_off</mat-icon>
            <p>No se encontraron clientes con los criterios de búsqueda</p>
          </mat-card-content>
        </mat-card>
      }

      @if (clientes().length > 0) {
        <mat-paginator
          [length]="totalRegistros()"
          [pageSize]="pageSize"
          [pageIndex]="pageIndex"
          [pageSizeOptions]="[10, 20, 50]"
          (page)="onPageChange($event)"
          showFirstLastButtons
        ></mat-paginator>
      }
    </div>

    <!-- Vista desktop: Tabla -->
    <div class="desktop-view">
      <mat-card>
        <table mat-table [dataSource]="clientes()" class="full-width">
          <ng-container matColumnDef="nombre">
            <th mat-header-cell *matHeaderCellDef>Nombre</th>
            <td mat-cell *matCellDef="let cliente">
              {{ cliente.nombre }} {{ cliente.apellido }}
            </td>
          </ng-container>

          <ng-container matColumnDef="dui">
            <th mat-header-cell *matHeaderCellDef>DUI</th>
            <td mat-cell *matCellDef="let cliente">{{ cliente.numeroDui }}</td>
          </ng-container>

          <ng-container matColumnDef="telefono">
            <th mat-header-cell *matHeaderCellDef>Teléfono</th>
            <td mat-cell *matCellDef="let cliente">{{ cliente.telefono || '-' }}</td>
          </ng-container>

          <ng-container matColumnDef="acciones">
            <th mat-header-cell *matHeaderCellDef>Acciones</th>
            <td mat-cell *matCellDef="let cliente">
              <button mat-icon-button (click)="verDetalle(cliente.id)">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button color="primary" (click)="editar(cliente.id)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="eliminar(cliente.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>

        @if (clientes().length === 0) {
          <div class="empty-table">
            <mat-icon>person_off</mat-icon>
            <p>No se encontraron clientes con los criterios de búsqueda</p>
          </div>
        }

        @if (clientes().length > 0) {
          <mat-paginator
            [length]="totalRegistros()"
            [pageSize]="pageSize"
            [pageIndex]="pageIndex"
            [pageSizeOptions]="[10, 20, 50]"
            (page)="onPageChange($event)"
            showFirstLastButtons
          ></mat-paginator>
        }
      </mat-card>
    </div>
  }
</div>
